#include <stdio.h>
#define IMAGE_XSIZE 15//24
#define IMAGE_YSIZE 15//24
#define FILTERSIZE 3

const int output[IMAGE_XSIZE][IMAGE_YSIZE] = {      {0, 0, 48, 0, 49, 0, 50, 0, 51, 0, 52, 0, 53, 0, 54}, 
                                                    {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 0, 0},
                                                    {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 0, 0}, 
                                                    {0, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 40, 0},
                                                    {111, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 221, 35},
                                                    {97, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 200, 171},
                                                    {40, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 97, 224},
                                                    {221, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 40, 0},
                                                    {1, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 43, 0, 0},
                                                    {0, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 43, 43, 224, 215},
                                                    {35, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 43, 43, 0, 85},
                                                    {172, 33, 34, 35, 36, 37, 38, 39, 40, 41, 43, 43, 44, 19, 97},
                                                    {224, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 110, 19},
                                                    {97, 0, 208, 40, 0, 224, 114, 24, 97, 0, 0, 0, 0, 240, 106},
                                                    {19, 97, 224, 215, 35, 97, 2, 0, 0, 0, 0, 0, 0, 0, 21}}; 

int main () {
   
    int main_result = 0; 

    int i, j, x, y, i_med, j_med, n;
    unsigned char min, temp;
    unsigned char temparray[FILTERSIZE];
    unsigned char image_o[IMAGE_XSIZE][IMAGE_YSIZE];
    unsigned char image_i[IMAGE_XSIZE][IMAGE_YSIZE] = { {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, /*15, 16, 17, 18, 19, 20, 21, 22, 23*/}, // 1
                                                        {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, /*15, 16, 17, 18, 19, 20, 21, 22, 23*/},
                                                        {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, /*15, 16, 17, 18, 19, 20, 21, 22, 23*/},
                                                        {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, /*15, 16, 17, 18, 19, 20, 21, 22, 23*/},
                                                        {21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, /*36, 37, 38, 39, 40, 41, 42, 43, 44*/}, // 5
                                                        {21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, /*36, 37, 38, 39, 40, 41, 42, 43, 44*/},
                                                        {21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, /*36, 37, 38, 39, 40, 41, 42, 43, 44*/},
                                                        {21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, /*36, 37, 38, 39, 40, 41, 42, 43, 44*/},
                                                        {31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 43, 43, 44, 45, /*46, 47, 48, 49, 50, 51, 53, 53, 54*/},
                                                        {31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 43, 43, 44, 45, /*46, 47, 48, 49, 50, 51, 53, 53, 54*/}, // 10
                                                        {31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 43, 43, 44, 45, /*46, 47, 48, 49, 50, 51, 53, 53, 54*/},
                                                        {31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 43, 43, 44, 45, /*46, 47, 48, 49, 50, 51, 53, 53, 54*/},
                                                        {41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, /*56, 57, 58, 59, 60, 61, 62, 63, 64*/},
                                                        {41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, /*56, 57, 58, 59, 60, 61, 62, 63, 64*/},
                                                        {41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, /*56, 57, 58, 59, 60, 61, 62, 63, 64*/}/*,
                                                        {41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64}, // 16
                                                        {51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74}, 
                                                        {51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74}, 
                                                        {51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74}, 
                                                        {51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74}, // 20 
                                                        {61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84}, 
                                                        {61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84}, 
                                                        {61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84}, 
                                                        {61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84}*/}; // 24


    for (i = 0; i < IMAGE_XSIZE-FILTERSIZE; i++){       // traverse image from origin till end of image minus the filter width 
        for (j = 0; j < IMAGE_YSIZE-FILTERSIZE; j++) {
            n = 0;
            for (x = 0; x < FILTERSIZE; x++) {          // at each point of the pixel, store a row of x values into an array
                for (y = 0; y < FILTERSIZE; y++) {
                    temparray[n] = image_i[i+x][j+y]; 
                    n++;
                }
            }

            /*find median -- kernel to process the array*/
            for (i_med = 0; i_med < 4; i_med++) {
                min = temparray[i_med];
                for (j_med = i_med + 1; j_med <= 8; j_med ++) {
                    if (temparray[j_med] < min)
                    {
                        temp = min;
                        min = temparray[j_med];
                        temparray[j_med] = temp;
                    }
                }
                temparray[i_med] = min;
            };
            min = temparray[4];
            for (j_med = 5; j_med <= 8; j_med ++) {
                if (temparray[j_med] < min) {
                    min = temparray[j_med];
                }
            }
            
            /*kernel to return the median filter to the output image*/
            image_o[i+1][j+1] = min;
        }
    }

    for ( x = 0; x < IMAGE_YSIZE; x++ ) {
        for ( y = 0; y < IMAGE_XSIZE; y++) {
            main_result += (output[x][y] != image_o[x][y]);
            

            //printf("image_o[%d][%d]: %d \n", x, y, image_o[x][y]);
        }
    }

    printf ("%d\n", main_result);

    return main_result;
}
